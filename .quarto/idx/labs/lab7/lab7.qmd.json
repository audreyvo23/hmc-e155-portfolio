{"title":"Lab 7: The Advanced Encryption Standard","markdown":{"yaml":{"title":"Lab 7: The Advanced Encryption Standard","author":"Audrey Vo","date":"10/29/24"},"headingText":"Main Goals","containsRefs":false,"markdown":"\n\nNumber of Hours Spent on Lab: 25 hours\n\n[GitHub Lab 7 Files](https://github.com/audreyvo23/e155-lab7)\n\nThe main goal of this lab was to build a system on an FPGA that can fit on the chip. An interface was also designed and implemented to allow for communication betweent the FPGA and MCU. Finally, a hardware accelerator was created to perform 128-bit AES encryption where a plaintext message key was being sent from the MCU to the accelerator and back. \n\n## Design Approach\n\n### AES Encryption Design\nIn order to create subBytes, sbox_sync was used to alter the input bits. Sbox_sync was used instead of sbox in order to store the LUT in RAM memory since a 16x16 would have been too large to store within our local memory. Sbox_sync was then called 16x on the 8 different rows of bytes of plaintext inputted to it, and allowed SubBytes to then output the 128 bits of modified text which was then fed into the shiftRows, mixColumns, and addRoundKey. In order to create the subModule keyExpansion, submodules rotWord and subWord were used to correctly output the roundKey values. These values were then also passed into addRoundkey to get the new cyphertext and into keyExpansion to get the new set of roundKey values. The design ensured that the modules would would go through the four submodules for a total of 9 times, only go through subByte, shiftRows, and addRoundKey for the 10th time, and then output the cyphertext. Below shows the path of the 128-bit AES encryption path and the Block Diagram of the modules used to implement this.\n\n![Full Path for 128-bit AES Encryption](images/lab7path.png)\n\n![Full Block Diagram of 128-bit AES Encryption System](images/lab7schematic.png)\n\n\n### FSM Design\nIn order to connect the submodules for the Encryption Design, an FSM was designed to determine what information should be passed to the AES submodules during each clock cycle. It was also used to determine the number of rounds the cyphertext had been encrypted, so that it would know when it is done. A delay was implemented between each submodule in the form of an extra state to take into account any clock delays from calling sbox_sync in keyExpansion and subByte.\n\n![FSM Design for 128-bit AES Encryption Process](images/lab7blockdiagram.png)\n\n### Pin Assignment\n\n| FPGA    | pin # |\n|---------|:------|\n| SDO     |   12  |  \n| SDI     |   10  | \n| SCLK    |   21  | \n| LOAD    |   26  | \n| DONE    |   27  | \n\n| MCU     | pin # |\n|---------|:------|\n| MISO    |   B4  |  \n| MOSI    |   B5  | \n| SCLK    |   B3  | \n| LOAD    |   A5  | \n| DONE    |   A6  | \n\n: Pin assignment to FPGA System Verilog Code and MCU C Code\n\n![Hardware Schematic for FPGA and MCU](images/lab7pins.png)\n\n\n## Testing Approach\nIn order to test the design, the System Verilog code was opened in ModelSim. A set of additional testbench files in System Verilog were created to test each of the submodules's functionality. \n\nThe subByte module, shiftRows module, keyExpansion module, and addRoundkey module were tested individually with known inputs and outputs. Once all of waveforms outputted matched the expected, a testbench for aes_core was then used to test the FSM design. As you can see below, the outputs of the aes_core testbench and aes_spi testbench were successful because it returned the expected values. \n\n\n![Testbench output for SubByte Module](images/lab7subbytetb.png)\n\n![Testbench output for ShiftRows Module](images/lab7shiftrowstb.png)\n\n![Testbench output for KeyExpansion Module](images/lab7keyexptb.png)\n\n![Testbench output for AddRoundKey Module](images/lab7arktb.png)\n\n![Testbench output for AES Core Module](images/lab7core2tb.png)\n\n![Testbench output for AES SPI Module](images/lab7spitb.png)\n\n\n## Design Requirements\nAfter testing the design in ModelSim, I can confirm the design meets all specs.\n\n\n","srcMarkdownNoYaml":"\n\nNumber of Hours Spent on Lab: 25 hours\n\n[GitHub Lab 7 Files](https://github.com/audreyvo23/e155-lab7)\n\n## Main Goals\nThe main goal of this lab was to build a system on an FPGA that can fit on the chip. An interface was also designed and implemented to allow for communication betweent the FPGA and MCU. Finally, a hardware accelerator was created to perform 128-bit AES encryption where a plaintext message key was being sent from the MCU to the accelerator and back. \n\n## Design Approach\n\n### AES Encryption Design\nIn order to create subBytes, sbox_sync was used to alter the input bits. Sbox_sync was used instead of sbox in order to store the LUT in RAM memory since a 16x16 would have been too large to store within our local memory. Sbox_sync was then called 16x on the 8 different rows of bytes of plaintext inputted to it, and allowed SubBytes to then output the 128 bits of modified text which was then fed into the shiftRows, mixColumns, and addRoundKey. In order to create the subModule keyExpansion, submodules rotWord and subWord were used to correctly output the roundKey values. These values were then also passed into addRoundkey to get the new cyphertext and into keyExpansion to get the new set of roundKey values. The design ensured that the modules would would go through the four submodules for a total of 9 times, only go through subByte, shiftRows, and addRoundKey for the 10th time, and then output the cyphertext. Below shows the path of the 128-bit AES encryption path and the Block Diagram of the modules used to implement this.\n\n![Full Path for 128-bit AES Encryption](images/lab7path.png)\n\n![Full Block Diagram of 128-bit AES Encryption System](images/lab7schematic.png)\n\n\n### FSM Design\nIn order to connect the submodules for the Encryption Design, an FSM was designed to determine what information should be passed to the AES submodules during each clock cycle. It was also used to determine the number of rounds the cyphertext had been encrypted, so that it would know when it is done. A delay was implemented between each submodule in the form of an extra state to take into account any clock delays from calling sbox_sync in keyExpansion and subByte.\n\n![FSM Design for 128-bit AES Encryption Process](images/lab7blockdiagram.png)\n\n### Pin Assignment\n\n| FPGA    | pin # |\n|---------|:------|\n| SDO     |   12  |  \n| SDI     |   10  | \n| SCLK    |   21  | \n| LOAD    |   26  | \n| DONE    |   27  | \n\n| MCU     | pin # |\n|---------|:------|\n| MISO    |   B4  |  \n| MOSI    |   B5  | \n| SCLK    |   B3  | \n| LOAD    |   A5  | \n| DONE    |   A6  | \n\n: Pin assignment to FPGA System Verilog Code and MCU C Code\n\n![Hardware Schematic for FPGA and MCU](images/lab7pins.png)\n\n\n## Testing Approach\nIn order to test the design, the System Verilog code was opened in ModelSim. A set of additional testbench files in System Verilog were created to test each of the submodules's functionality. \n\nThe subByte module, shiftRows module, keyExpansion module, and addRoundkey module were tested individually with known inputs and outputs. Once all of waveforms outputted matched the expected, a testbench for aes_core was then used to test the FSM design. As you can see below, the outputs of the aes_core testbench and aes_spi testbench were successful because it returned the expected values. \n\n\n![Testbench output for SubByte Module](images/lab7subbytetb.png)\n\n![Testbench output for ShiftRows Module](images/lab7shiftrowstb.png)\n\n![Testbench output for KeyExpansion Module](images/lab7keyexptb.png)\n\n![Testbench output for AddRoundKey Module](images/lab7arktb.png)\n\n![Testbench output for AES Core Module](images/lab7core2tb.png)\n\n![Testbench output for AES SPI Module](images/lab7spitb.png)\n\n\n## Design Requirements\nAfter testing the design in ModelSim, I can confirm the design meets all specs.\n\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"toc":true,"output-file":"lab7.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.57","theme":"cosmo","title":"Lab 7: The Advanced Encryption Standard","author":"Audrey Vo","date":"10/29/24"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}